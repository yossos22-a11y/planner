<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>원형 실시간 계획표</title>

<style>
:root{ --size: min(90vw, 380px); }
*{ box-sizing:border-box; }

body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  font-family: system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
  background:#fff;
  padding-top: env(safe-area-inset-top);
}

.wrap{ width:100%; max-width:560px; padding:16px; }

.card{
  border:1px solid #eee;
  border-radius:18px;
  padding:14px;
  box-shadow:0 6px 20px rgba(0,0,0,.06);
}

/* 상단 날짜/시간 */
.topBig{
  display:flex;
  justify-content:center;
  align-items:center;
  margin-bottom:12px;
}
.topBig span{
  font-weight:900;
  font-size:clamp(18px, 5vw, 28px);
  color:#000;
  font-variant-numeric: tabular-nums;
  white-space:nowrap;
}

/* 원형 */
.dial{ width:var(--size); height:var(--size); margin:0 auto; }
svg{ width:100%; height:100%; display:block; }

/* 하단 수동 타이머 */
.timerBox{
  margin-top:14px;
  border:1px solid #f0f0f0;
  border-radius:16px;
  padding:12px;
  display:grid;
  gap:10px;
}
.timerTop{
  display:flex;
  justify-content:space-between;
  align-items:baseline;
}
.timerTitle{ font-weight:900; font-size:16px; }
.timerDisplay{
  font-weight:900;
  font-size:28px;
  font-variant-numeric: tabular-nums;
}
.progress{
  height:10px;
  border-radius:999px;
  background:#f1f1f1;
  overflow:hidden;
}
.progress > div{ height:100%; width:0%; background:#000; }

.timerControls{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.field{ display:flex; gap:6px; align-items:center; }
.field label{ font-weight:800; font-size:14px; }
.field input{
  width:70px;
  padding:8px 10px;
  border:1px solid #e5e5e5;
  border-radius:12px;
  font-weight:900;
}
.btns{ display:flex; gap:8px; }
button{
  border:1px solid #e5e5e5;
  background:#fff;
  padding:10px 12px;
  border-radius:14px;
  font-weight:900;
  cursor:pointer;
}
button.primary{ border-color:#000; }
</style>
</head>

<body>
<div class="wrap">
<div class="card">

  <div class="topBig">
    <span id="topDateTime">----</span>
  </div>

  <div class="dial">
    <svg viewBox="-6 -6 112 112">

      <g id="hours"></g>

      <circle cx="50" cy="50" r="40"
        fill="none" stroke="#e7e7e7" stroke-width="12"/>

      <g id="arcs"></g>
      <g id="labels"></g>

      <line id="hand" x1="50" y1="50" x2="50" y2="12"
        stroke="#000" stroke-width="0.9"/>

      <polygon id="arrow"
        points="0,-2 -1.6,1.6 1.6,1.6"
        fill="#000"/>

      <!-- 중앙 정보 -->
      <g id="centerInfo">
        <circle cx="50" cy="50" r="18" fill="#fff" opacity="0.95"/>
        <circle cx="50" cy="50" r="2.2" fill="#fff"/>

        <text id="centerLabel" x="50" y="42"
          text-anchor="middle" fill="#000"
          font-size="5" font-weight="900">-</text>

        <text id="centerRange" x="50" y="49"
          text-anchor="middle" fill="#000"
          font-size="4.6" font-weight="800"
          style="font-variant-numeric:tabular-nums">--:--~--:--</text>

        <!-- 구간 종료까지 남은 시간 -->
        <text id="centerRemain" x="50" y="56"
          text-anchor="middle" fill="#555"
          font-size="3.5" font-weight="700"></text>

        <!-- ✅ 22:00 수면 시작까지 남은 시간 -->
        <text id="centerToSleep" x="50" y="61.5"
          text-anchor="middle" fill="#777"
          font-size="3.2" font-weight="700"></text>
      </g>

    </svg>
  </div>

  <!-- 하단 수동 타이머 -->
  <div class="timerBox">
    <div class="timerTop">
      <div class="timerTitle">타이머</div>
      <div class="timerDisplay" id="timerDisplay">00:25:00</div>
    </div>

    <div class="progress"><div id="timerBar"></div></div>

    <div class="timerControls">
      <div style="display:flex; gap:10px;">
        <div class="field">
          <label>시</label>
          <input id="timerHours" type="number" min="0" max="99" value="0">
        </div>
        <div class="field">
          <label>분</label>
          <input id="timerMinutes" type="number" min="0" max="59" value="25">
        </div>
      </div>
      <div class="btns">
        <button class="primary" id="btnStart">시작</button>
        <button id="btnPause">정지</button>
        <button id="btnReset">리셋</button>
      </div>
    </div>
  </div>

</div>
</div>

<script>
/* ===== 스케줄 (현재 너 일정) ===== */
const SEGMENTS=[
  {start:"05:00", end:"05:30", label:"기상", color:"#FF8A00"},
  {start:"05:30", end:"06:30", label:"공부", color:"#5BC0FF"},
  {start:"06:30", end:"09:30", label:"육아/가사", color:"#FFD400"},
  {start:"09:30", end:"11:00", label:"공부", color:"#5BC0FF"},
  {start:"11:00", end:"13:30", label:"육아/가사", color:"#FFD400"},
  {start:"13:30", end:"15:00", label:"공부", color:"#5BC0FF"},
  {start:"15:00", end:"21:00", label:"육아/가사", color:"#FFD400"},
  {start:"21:00", end:"22:00", label:"취침준비", color:"#0B2A6F"},
  {start:"22:00", end:"05:00", label:"수면", color:"#7A3FF2"},
];

/* ✅ 수면 시작 시각(고정 목표) */
const SLEEP_START = "22:00";

const DOW=["일","월","화","수","목","금","토"];
const R=40;

const arcsG=document.getElementById("arcs");
const labelsG=document.getElementById("labels");
const hoursG=document.getElementById("hours");

const centerLabel=document.getElementById("centerLabel");
const centerRange=document.getElementById("centerRange");
const centerRemain=document.getElementById("centerRemain");
const centerToSleep=document.getElementById("centerToSleep");

const hand=document.getElementById("hand");
const arrow=document.getElementById("arrow");
const topDateTime=document.getElementById("topDateTime");

const toMin=t=>{const[a,b]=t.split(":").map(Number);return a*60+b;}
const pad=n=>String(n).padStart(2,"0");
const fracToRad=f=>f*2*Math.PI-Math.PI/2;

function arcPath(s,e){
  let d=e-s; if(d<=0)d+=1;
  const a0=fracToRad(s), a1=fracToRad(e);
  return `M ${50+R*Math.cos(a0)} ${50+R*Math.sin(a0)}
          A ${R} ${R} 0 ${d>0.5?1:0} 1
          ${50+R*Math.cos(a1)} ${50+R*Math.sin(a1)}`;
}

function build(){
  for(let h=1;h<=24;h++){
    const a=fracToRad(h/24);
    hoursG.innerHTML+=`<text x="${50+50*Math.cos(a)}" y="${50+50*Math.sin(a)}"
      text-anchor="middle" dominant-baseline="middle"
      fill="#111" opacity=".7" font-size="3.2">${h}</text>`;
  }

  SEGMENTS.forEach(s=>{
    const a=toMin(s.start)/1440, b=toMin(s.end)/1440;
    arcsG.innerHTML+=`<path d="${arcPath(a,b>a?b:1)}" stroke="${s.color}" stroke-width="14" fill="none"/>`;
    if(b<a) arcsG.innerHTML+=`<path d="${arcPath(0,b)}" stroke="${s.color}" stroke-width="14" fill="none"/>`;

    const mid=((toMin(s.start)+(toMin(s.end)-toMin(s.start)+1440)%1440/2)%1440)/1440;
    const ang=fracToRad(mid);
    labelsG.innerHTML+=`<text x="${50+40*Math.cos(ang)}" y="${50+40*Math.sin(ang)}"
      fill="#fff" stroke="rgba(0,0,0,.35)" stroke-width=".35"
      paint-order="stroke fill" font-size="4" font-weight="800"
      text-anchor="middle" dominant-baseline="middle">${s.label}</text>`;
  });
}

function formatRemainHM(mins){
  const h=Math.floor(mins/60), m=mins%60;
  return `${h>0 ? h+"시간 " : ""}${m}분`;
}

function update(){
  const n=new Date();
  topDateTime.textContent=
    `${n.getFullYear()}-${pad(n.getMonth()+1)}-${pad(n.getDate())} `
  + `${DOW[n.getDay()]} `
  + `${pad(n.getHours())}:${pad(n.getMinutes())}:${pad(n.getSeconds())}`;

  const nowMin=n.getHours()*60+n.getMinutes();

  // 현재 구간 찾기
  const idx=SEGMENTS.findIndex(s=>{
    const a=toMin(s.start), b=toMin(s.end);
    return b>a ? nowMin>=a&&nowMin<b : nowMin>=a||nowMin<b;
  });

  if(idx>=0){
    const seg=SEGMENTS[idx];
    centerLabel.textContent=seg.label;
    centerRange.textContent=`${seg.start}~${seg.end}`;

    // 1) 구간 종료까지 남은 시간
    let remainSeg=toMin(seg.end)-nowMin;
    if(remainSeg<0) remainSeg+=1440;
    centerRemain.textContent =
      remainSeg<=0 ? "곧 종료" : `남은 시간 ${formatRemainHM(remainSeg)}`;

    // 2) 22:00(수면 시작)까지 남은 시간
    const sleepStartMin = toMin(SLEEP_START);
    let remainToSleep = sleepStartMin - nowMin;
    if(remainToSleep < 0) remainToSleep += 1440;

    // 수면 시작 이후(22:00~24:00~)에는 "내일 22:00까지" 남은 시간이 나오게 됨 (의도대로)
    centerToSleep.textContent =
      `22:00까지 ${formatRemainHM(remainToSleep)} 남음`;
  }

  // 바늘+화살표
  const frac=(n.getHours()*3600+n.getMinutes()*60+n.getSeconds())/86400;
  const ang=fracToRad(frac);
  hand.setAttribute("x2",50+(R-2)*Math.cos(ang));
  hand.setAttribute("y2",50+(R-2)*Math.sin(ang));
  arrow.setAttribute("transform",`translate(${50+(R-2)*Math.cos(ang)} ${50+(R-2)*Math.sin(ang)}) rotate(${ang*180/Math.PI+90})`);

  requestAnimationFrame(update);
}

/* ===== 하단 수동 타이머 ===== */
let dur=25*60*1000, remain=dur, run=false, last=0;
const tDisp=document.getElementById("timerDisplay");
const tBar=document.getElementById("timerBar");
const hIn=document.getElementById("timerHours");
const mIn=document.getElementById("timerMinutes");

function fmt(ms){
  const s=Math.max(0,Math.floor(ms/1000));
  return `${pad(Math.floor(s/3600))}:${pad(Math.floor(s%3600/60))}:${pad(s%60)}`;
}
function sync(){
  tDisp.textContent=fmt(remain);
  tBar.style.width=`${100*(1-remain/dur)}%`;
}
function apply(){
  dur=(+hIn.value*3600+ +mIn.value*60)*1000 || 1000;
  remain=dur; run=false; last=0; sync();
}
document.getElementById("btnStart").onclick=()=>{run=true; last=performance.now();}
document.getElementById("btnPause").onclick=()=>{run=false;}
document.getElementById("btnReset").onclick=apply;
hIn.oninput=mIn.oninput=apply;

function tick(){
  if(run){
    const now=performance.now();
    if(last){ remain-=now-last; if(remain<=0){remain=0; run=false;} }
    last=now; sync();
  }
  requestAnimationFrame(tick);
}

build(); apply(); tick(); update();
</script>
</body>
</html>
